var t={light:{bg_color:"#E0E0E0",bg_border_color:"#BDBDBD",track_bg_color:"#CFD8DC",track_color_init:"#64B5F6",track_color:"#42A5F5",cursor_color_init:"#64B5F6",cursor_color:"#42A5F5",markers_color:"#9E9E9E",font_color:"#424242"},light2:{bg_color:"#B1DAEE",bg_border_color:"#569DC0",track_bg_color:"#B1DAEE",track_color_init:"#569DC0",track_color:"#1D6D93",cursor_color_init:"#569DC0",cursor_color:"#1D6D93",markers_color:"#3680A4",font_color:"#1D6D93"},dark:{bg_color:"#000000",bg_border_color:"#569DC0",track_bg_color:"#424242",track_color_init:"#FDD835",track_color:"#FFEC00",cursor_color_init:"#569DC0",cursor_color:"#FDD835",markers_color:"#3680A4",font_color:"#FFEA00"}};module.exports=function(e,r){if(void 0===r&&(r={}),!e)throw"You must pass a DOM node reference to the Knob constructor";var n,o=!1,a="http://www.w3.org/2000/svg",l=!0,i=!l,s=50,u=s,c=50,_=100;("string"==typeof e||e instanceof String)&&(e=document.querySelector(e));var d=e.nodeName.toLowerCase();if("g"===d){var g=(n=e).getBBox();u=g.x+.5*g.width,c=g.y+.5*g.height,_=g.width}else{if("div"!==d)throw"Unsupported element type for creating knob, should be a div or an SVG g element!";n=document.createElementNS("http://www.w3.org/2000/svg","svg"),e.appendChild(n)}var b={label:!1,rotation:l,default_value:0,initial_value:0,value_min:0,value_max:100,value_resolution:1,center_zero:!1,center_value:null,center_gap:4,zero_at:270,angle_min:30,angle_max:330,bg_radius:32,bg_border_width:1,track_bg_radius:40,track_bg_width:8,track_radius:40,track_width:8,cursor_radius:18,cursor_length:10,cursor_width:4,palette:"light",bg:!1,track_bg:!0,track:!0,cursor:!1,linecap:"butt",value_text:!0,value_position:58,font_family:"sans-serif",font_size:25,display_raw:!1,format_raw:function(t){return Math.round(t)},format:function(t){return t},font_weight:"bold",markers:0,markers_radius:40,markers_length:8,markers_width:2,class_bg:"knob-bg",class_track_bg:"knob-track-bg",class_track:"knob-track",class_value:"knob-value",class_cursor:"knob-cursor",class_markers:"knob-markers",snap_to_steps:!1,mouse_wheel_acceleration:1,onchange:null},m=JSON.parse(e.dataset.config||"{}"),h=Object.assign({},b,t[b.palette],r,m),v=Object.assign(h,t[h.palette],r,m);n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),100===_&&n.setAttributeNS(null,"viewBox","0 0 100 "+(v.label||v.value_position>=_-v.font_size/2?120:100));var f,k,p=0,A=0,w=0,x=0,E=v.angle_min,M=null,S=null,y=null,D=null,N=null,C=null,z=null,F=null,L=null,P=!1;function B(){o&&console.log("init()"),v.center_zero&&(v.center_value||(v.center_value=T((v.value_max-v.value_min)/2+v.value_min))),"butt"===v.linecap?(w=U(180*Math.acos(-v.center_gap/100)/Math.PI),x=U(180*Math.acos(v.center_gap/100)/Math.PI)):(w=U(180*Math.acos(-(1.3*v.track_width+v.center_gap)/100)/Math.PI),x=U(180*Math.acos((1.3*v.track_width+v.center_gap)/100)/Math.PI))}function I(){j(v.initial_value?v.initial_value:v.default_value)}function T(t){return null===v.value_resolution?t:Math.round(t/v.value_resolution)*v.value_resolution}function O(t){o&&console.log("getDisplayValue",v.display_raw);var e=Y(t);return v.display_raw?v.format_raw(e):v.format(e)}function V(){var t;return t=Math.abs(v.value_max-v.value_min),1===Math.abs(t%2)?.5:0}function Y(t){return T(((void 0===t?E:t)-v.angle_min)/(v.angle_max-v.angle_min)*(v.value_max-v.value_min)+v.value_min-V())}function j(t){return K((t+V()-v.value_min)/(v.value_max-v.value_min)*(v.angle_max-v.angle_min)+v.angle_min),o&&console.log("setValue("+t+") angle="+(t-v.value_min)/(v.value_max-v.value_min)*(v.angle_max-v.angle_min)+v.angle_min),!0}function K(t,r){var n=E,a=r&&t!==E;E=Math.min(Math.max(t,v.angle_min),v.angle_max),a&&Y(n)!==Y()&&function(){o&&console.log("knob value has changed");var t=Y(),r=new CustomEvent("change",{detail:t});e.dispatchEvent(r),v.onchange&&v.onchange(t)}()}function R(t){var e=v.zero_at-t;return e<0&&(e+=360),o&&console.log("knobToPolarAngle "+t+" -> "+e),e}function U(t){return o&&console.log("polarToKnobAngle "+t+" -> "+(v.zero_at-t+360)%360),(v.zero_at-t+360)%360}function X(t){var e=t.clientX-f.left,r=t.clientY-f.top,n=(e-p)/(f.width/2),a=-(r-A)/(f.width/2);v.rotation===i&&(n=-n);var l=Math.atan2(a,n);l<0&&(l=2*Math.PI+l),o&&console.log("mouseUpdate: position in svg = "+e+", "+r+" pixels; "+n.toFixed(3)+", "+a.toFixed(3)+" rel.; angle "+l.toFixed(3)+" rad"),K(U(180*l/Math.PI),!0)}function q(t){t.preventDefault(),X(t),ot()}function G(){o&&console.log("endDrag"),document.removeEventListener("mousemove",q,!1),document.removeEventListener("mouseup",G,!1)}function H(t){o&&console.log("handleTouch",t.touches),t.preventDefault();var e=t.touches.length-1,r=t.touches[e].clientX-f.left,n=t.touches[e].clientY-f.top,a=(r-p)/(f.width/2),l=-(n-A)/(f.width/2);v.rotation===i&&(a=-a);var s=Math.atan2(l,a);s<0&&(s=2*Math.PI+s),o&&console.log("handleTouch: position in svg = "+r+", "+n+" pixels; "+a.toFixed(3)+", "+l.toFixed(3)+" rel.; angle "+s.toFixed(3)+" rad"),K(U(180*s/Math.PI),!0),ot()}function J(){o&&console.log("endTouch"),document.removeEventListener("touchmove",H),document.removeEventListener("touchend",J)}function Q(t,e){var r=t*Math.PI/180,n=void 0===e?v.track_radius:e,o=Math.cos(r)*n,a=Math.sin(r)*n;return{x:v.rotation===l?u+o:u-o,y:c-a}}function W(t,e,r){o&&console.group("getArc("+t+", "+e+", "+r+")");var n=R(t),a=R(e);t!==e&&(n-=1e-4,a+=1e-4);var i=Q(n,r),s=i.x,u=i.y,c=Q(a,r),_="M "+s+","+u+" A "+r+","+r+" 0 "+((n-a+360)%360<180?0:1)+","+(v.rotation===l?1:0)+" "+c.x+","+c.y;return o&&console.groupEnd(),o&&console.log("arc: "+_),_}function Z(){o&&console.log("getTrackPath()");var t=null;if(v.center_zero){if(Array.isArray(v.center_value)){if(v.center_value.includes(Y()))return o&&console.log("getTrackPath: center position, track not drawn"),t}else if(Y()===v.center_value)return o&&console.log("getTrackPath: center position, track not drawn"),t;E<180?t=W(Math.min(E,w),w,v.track_radius):E>180&&(t=W(x,Math.max(E,x),v.track_radius))}else t=W(v.angle_min,E,v.track_radius);return t}function $(){if(o&&console.log("draw_track()",v.track),v.track){var t=Z();t&&((N=document.createElementNS(a,"path")).setAttributeNS(null,"d",t),N.setAttribute("stroke",""+v.track_color_init),N.setAttribute("stroke-width",""+v.track_width),N.setAttribute("fill","transparent"),N.setAttribute("stroke-linecap",v.linecap),N.setAttribute("class",v.class_track),n.appendChild(N))}}function tt(){var t=R(E),e=Q(t,v.cursor_radius),r=Q(t,v.cursor_radius+v.cursor_length);return"M "+e.x+","+e.y+" L "+r.x+","+r.y}function et(t,e){if(void 0===e&&(e=!1),"string"!=typeof t)return v.font_size;var r=Math.min(22,t.length);return e?v.font_size*Math.min(.75,Math.max((22-r)/22,.25)):v.font_size*Math.max((22-r)/22,.25)}function rt(t,e){void 0===e&&(e=!1),o&&console.log("draw_value_line1",t),(F=document.createElementNS(a,"text")).setAttributeNS(null,"x",""+s),F.setAttributeNS(null,"y",""+v.value_position),F.setAttribute("text-anchor","middle"),F.setAttribute("cursor","default"),F.setAttribute("font-family",v.font_family),F.setAttribute("font-size",""+et(t,e)),F.setAttribute("font-weight",""+v.font_weight),F.setAttribute("fill",v.font_color),F.setAttribute("class",v.class_value),F.textContent=t,n.appendChild(F)}function nt(t){o&&console.log("draw_value_line2",t),(L=document.createElementNS(a,"text")).setAttributeNS(null,"x",""+s),L.setAttributeNS(null,"y",""+(v.value_position+4)),L.setAttribute("text-anchor","middle"),L.setAttribute("cursor","default"),L.setAttribute("font-family",v.font_family),L.setAttribute("font-size",""+et(t,!0)),L.setAttribute("font-weight",""+v.font_weight),L.setAttribute("fill",v.font_color),L.setAttribute("class",v.class_value),L.textContent=t,n.appendChild(L)}function ot(){o&&console.log("redraw()",v);var t=Z();t?N?(o&&console.log("redraw track already exist, update d"),N.setAttributeNS(null,"d",t)):(o&&console.log("redraw draw_track"),$()):N&&(o&&console.log("redraw track already exist, hide it"),N.setAttributeNS(null,"d","")),P||(P=Y()!==v.default_value)&&N&&N.setAttribute("stroke",""+v.track_color),C&&(t=tt())&&(o&&console.log("redraw cursor"),C.setAttributeNS(null,"d",t),P&&C.setAttribute("stroke",""+v.cursor_color)),F&&(o&&console.log("redraw svg_value_text"),function(){if(o&&console.log("update_value",v.value_text),v.value_text){var t=O();if("number"==typeof t||t.indexOf("\n")<=0)o&&console.log("single line"),F&&(F.setAttributeNS(null,"y",""+v.value_position),F.setAttribute("font-size",""+et(t)),F.textContent=t),L&&(n.removeChild(L),L=null);else{var e=t.split("\n");o&&console.log("two lines",t,e),F&&(F.setAttributeNS(null,"y",""+(v.value_position-12)),F.setAttribute("font-size",""+et(e[0],!0)),F.textContent=e[0]),L?(L.setAttributeNS(null,"y",""+(v.value_position+4)),L.setAttribute("font-size",""+et(e[1],!0)),L.textContent=e[1]):nt(e[1])}}}())}return B(),I(),o&&console.log("draw()",v),o&&console.log("draw_background()",v.bg),v.bg&&((M=document.createElementNS(a,"circle")).setAttributeNS(null,"cx",""+u),M.setAttributeNS(null,"cy",""+c),M.setAttributeNS(null,"r",""+v.bg_radius),M.setAttribute("fill",""+v.bg_color),M.setAttribute("stroke",""+v.bg_border_color),M.setAttribute("stroke-width",""+v.bg_border_width),M.setAttribute("class",v.class_bg),n.appendChild(M)),o&&console.log("draw_track_background()",v.track_bg),v.track_bg&&(v.center_zero?((y=document.createElementNS(a,"path")).setAttributeNS(null,"d",W(v.angle_min,w,v.track_bg_radius)),y.setAttribute("stroke",""+v.track_bg_color),y.setAttribute("stroke-width",""+v.track_bg_width),y.setAttribute("stroke-linecap",v.linecap),y.setAttribute("fill","transparent"),y.setAttribute("class",v.class_track_bg),n.appendChild(y),(D=document.createElementNS(a,"path")).setAttributeNS(null,"d",W(x,v.angle_max,v.track_bg_radius)),D.setAttribute("stroke",""+v.track_bg_color),D.setAttribute("stroke-width",""+v.track_bg_width),D.setAttribute("stroke-linecap",v.linecap),D.setAttribute("fill","transparent"),D.setAttribute("class",v.class_track_bg),n.appendChild(D)):((S=document.createElementNS(a,"path")).setAttributeNS(null,"d",W(v.angle_min,v.angle_max,v.track_bg_radius)),S.setAttribute("stroke",""+v.track_bg_color),S.setAttribute("stroke-width",""+v.track_bg_width),S.setAttribute("fill","transparent"),S.setAttribute("stroke-linecap",v.linecap),S.setAttribute("class",v.class_track_bg),n.appendChild(S))),function(){if(o&&console.log("draw_markers()",v.markers),v.markers){for(var t="",e=(v.angle_max-v.angle_min)/v.markers,r=v.angle_min;r<=v.angle_max;r+=e){var l=Q(R(r),v.markers_radius),i=Q(R(r),v.markers_radius+v.markers_length);t+="M "+l.x+","+l.y+" L "+i.x+","+i.y+" "}(z=document.createElementNS(a,"path")).setAttributeNS(null,"d",t),z.setAttribute("stroke",""+v.markers_color),z.setAttribute("stroke-width",""+v.markers_width),z.setAttribute("stroke-linecap",v.linecap),z.setAttribute("class",v.class_markers),n.appendChild(z)}}(),$(),function(){if(o&&console.log("draw_cursor()",v.cursor),v.cursor){var t=tt();t&&((C=document.createElementNS(a,"path")).setAttributeNS(null,"d",t),C.setAttribute("stroke",""+v.cursor_color_init),C.setAttribute("stroke-width",""+v.cursor_width),C.setAttribute("fill","transparent"),C.setAttribute("stroke-linecap",v.linecap),C.setAttribute("class",v.class_cursor),n.appendChild(C))}}(),function(){if(o&&console.log("draw_value",v.value_text),v.value_text){var t=O();if("number"==typeof t||t.indexOf("\n")<=0)o&&console.log("single line"),rt(t);else{var e=t.split("\n");o&&console.log("two lines",e),rt(e[0],!0),nt(e[1])}}}(),o&&console.log("attach attachEventHandlers"),n.addEventListener("mousedown",function(t){!function(t){o&&console.log("startDrag"),t.preventDefault(),f=n.getBoundingClientRect(),A=p=f.width/2,document.addEventListener("mousemove",q,!1),document.addEventListener("mouseup",G,!1),X(t),ot()}(t)}),n.addEventListener("wheel",function(t){!function(t){t.preventDefault();var e=t.deltaY;0!==e&&(k>Math.abs(e)||!k)&&(k=Math.abs(e)),K(Math.min(Math.max(E+e/k*1*v.mouse_wheel_acceleration,v.angle_min),v.angle_max),!0),ot()}(t)}),n.addEventListener("touchstart",function(t){o&&console.log("startTouch"),t.preventDefault(),f=n.getBoundingClientRect(),A=p=f.width/2,document.addEventListener("touchmove",H,{passive:!1}),document.addEventListener("touchend",J)},{passive:!1}),{set value(t){j(t),ot()},set config(t){v=Object.assign({},b,v,t),B(),ot()},setConfigValue:function(t,e){v[t]=e,B(),ot()},initValue:I,enableDebug:function(){o=!0},disableDebug:function(){o=!1}}};
//# sourceMappingURL=index.js.map
